<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"mybatis-3-mapper.dtd">
<mapper namespace="com.wind.frame.login">

	<select id="anySelect" parameterType="String" resultType="hashMap"> 
		${value}
	</select>
	
	<insert id="anyInsert" parameterType="hashMap" >
        insert into ${tableName}
        <foreach collection="params.keys" item="k" index="index" open="(" separator="," close=")">
            ${k}
        </foreach>
        values
        <foreach collection="params.keys" item="k" index="index" open="(" separator="," close=")">
            '${params[k]}'
        </foreach>
    </insert>
    
    <delete id="anyDelete" parameterType="hashMap" >
    	delete from ${tableName} where 1 = 1
    	<foreach collection="params.keys" item="k" index="index" open="and" separator="and">
            ${k} = '${params[k]}'
        </foreach>
    </delete>
    
    <update id="anyUpdate" parameterType="hashMap" >
    	update ${tableName}
    	<set>
    		<foreach collection="params.keys" item="k" index="index" separator=",">
	    		<if test="params[k] == null">
	    			${k} = null
	    		</if>
	    		<if test="params[k] != null">
	    			${k} = '${params[k]}'
	    		</if>
        	</foreach>
    	</set>
    	where 1 = 1
    	<foreach collection="qryParams.keys" item="k" index="index" open="and" separator=" ">
            ${k} = '${qryParams[k]}'
        </foreach>
    </update>

	<select id="selectFrame_account" parameterType="hashMap"
		resultType="hashMap">
		<if test="record_count == null and page != null and page != ''">
			select * from (select rownum as rowidx, qry.* from (
		</if>
		select 
		<if test="record_count == null">
			*
		</if>
		<if test="record_count != null">
			count(1) as record_count
		</if>
		from FRAME_ACCOUNT 
		<where>
			<if test="account != null and account != ''">
				account =#{account}
			</if>
			<if test="account_kind != null and account_kind != ''">
				and account_kind =#{account_kind}
			</if>
			<if test="busi_id != null and busi_id != ''">
				and busi_id =#{busi_id}
			</if>
			<if test="account_id != null and account_id != ''">
				account_id =#{account_id}
			</if>
		</where>
		<if test="record_count == null and page != null and page != ''">
			)qry ) where rowidx > (#{page} - 1) * #{rows} and   rowidx &lt;= #{page} * #{rows}
		</if>
	</select>
	
	<select id="selectFrame_config" parameterType="hashMap"
		resultType="hashMap">
		select * from frame_config
		<where>
			<if test="config_name != null and config_name != ''">
				config_name =#{config_name}
			</if>
		</where>
	</select>
	
	<select id="selectMenusOfAccount" parameterType="string"
		resultType="hashMap">
		with account_roles as
		 (select role_id from frame_account_role where account_id = #{account_id})
		select a.*, g.group_name
		  from FRAME_MENU a
		 inner join frame_menu_group g
		    on a.menu_group_id = g.menu_group_id
		 where exists (select 1
		          from frame_role_menu_group b
		         where g.menu_group_id = b.menu_group_id
		           and b.role_id in (select * from account_roles))
		    or exists
		 (select 1
		          from frame_role_menu d
		         where d.menu_id = a.menu_id
		           and d.role_id in (select * from account_roles))
		 order by g.group_order, a.menu_order
	</select>
	
	<select id="selectFrame_menu_group" parameterType="hashMap"
		resultType="hashMap">
		select * from frame_menu_group order by group_pid, group_order
	</select>
	
	<select id="selectFrame_menu" parameterType="hashMap"
		resultType="hashMap">
		select * from frame_menu
	</select>
	
	<select id="selectFrame_code_map" parameterType="string"
		resultType="hashMap">
		select * from FRAME_CODE_map where code_name = #{code_name} order by code_value_order
	</select>
	
	<select id="selectFrame_code" resultType="hashMap">
		select * from FRAME_CODE
	</select>
	
	<select id="selectView_frame_role_mgd" parameterType="hashMap"
		resultType="hashMap">
		select * from view_frame_role_mgd a
		<where>
			<if test="account_id != null and account_id != ''">
				exists (select 1
				          from frame_account_role b
				         where a.ROLE_ID = b.role_id
				           and b.account_id = #{account_id})
			</if>
		</where>
		order by role_order
	</select>

</mapper>